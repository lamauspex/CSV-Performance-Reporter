# ReportGenerator

Система генерации отчетов для анализа данных сотрудников.

## Обзор

ReportGenerator представляет собой расширяемую систему для создания различных типов отчетов на основе данных сотрудников. Архитектура построена на паттерне Strategy с использованием абстрактного базового класса.

## Архитектура

```
BaseReport (ABC)
├── PerformanceReport
└── SkillsReport

ReportGenerator (Factory)
```

## BaseReport

Абстрактный базовый класс для всех отчетов.

### Конструктор

### __init__(name: str)

Создает экземпляр отчета с указанным именем.

**Параметры:**
- `name: str` - имя отчета

**Атрибуты:**
- `name: str` - имя отчета

### Абстрактные методы

### generate(data: List[Dict[str, Any]]) -> str

Генерирует отчет на основе данных сотрудников.

**Параметры:**
- `data: List[Dict[str, Any]]` - список словарей с данными сотрудников

**Возвращает:**
- `str` - отформатированный отчет

---

## PerformanceReport

Отчет по эффективности сотрудников, группирующий данные по позициям.

### Конструктор

### __init__()

Создает отчет по эффективности с именем "performance".

### Основные методы

### generate(data: List[Dict[str, Any]]) -> str

Генерирует отчет по эффективности сотрудников.

**Возвращаемый отчет включает:**
- Позиции сотрудников
- Среднюю эффективность по каждой позиции
- Количество сотрудников в каждой позиции
- Сортировку по эффективности (настраивается через конфигурацию)

**Параметры:**
- `data: List[Dict[str, Any]]` - данные сотрудников

**Возвращает:**
- `str` - отформатированная таблица с отчетом

**Пример вывода:**
```
╔════╤══════════════════════╤═════════════════════╤═══════════════════════════╗
║ №  │ Позиция              │Средняя эффективность│ Количество сотрудников    ║
╠════╪══════════════════════╪═════════════════════╪═══════════════════════════╣
║ 1  │ Backend Developer    │ 4.67                │ 3                         ║
║ 2  │ Mobile Developer     │ 4.63                │ 3                         ║
╚════╧══════════════════════╧═════════════════════╧═══════════════════════════╝
```

### Вспомогательные методы

#### _group_by_position()

Группирует данные сотрудников по позициям.

**Параметры:**
- `data: List[Dict[str, Any]]` - данные сотрудников

**Возвращает:**
- `Dict[str, Dict[str, Any]]` - данные, сгруппированные по позициям

#### _calculate_average_performance()

Вычисляет среднюю эффективность для каждой позиции.

**Параметры:**
- `position_data: Dict[str, Dict[str, Any]]` - сгруппированные данные

**Возвращает:**
- `List[Dict[str, Any]]` - статистика по позициям

#### _sort_data()

Сортирует данные согласно конфигурации.

**Параметры:**
- `report_data: List[Dict[str, Any]]` - данные для сортировки

**Возвращает:**
- `List[Dict[str, Any]]` - отсортированные данные

**Конфигурация:**
- `SORT_BY_PERFORMANCE` - включить/выключить сортировку
- `SORT_ORDER` - порядок сортировки ('asc' или 'desc')

#### _format_table()

Форматирует данные в таблицу с использованием tabulate.

**Параметры:**
- `sorted_data: List[Dict[str, Any]]` - отсортированные данные

**Возвращает:**
- `str` - отформатированная таблица

#### _generate_empty_report()

Генерирует пустую таблицу для случая отсутствия данных.

**Возвращает:**
- `str` - пустая таблица с заголовками

---

## SkillsReport

Отчет по навыкам сотрудников, анализирующий распределение навыков и компетенции.

### Конструктор

### __init__()

Создает отчет по навыкам с именем "skills".

### Основные методы

### generate(data: List[Dict[str, Any]]) -> str

Генерирует комплексный отчет по навыкам сотрудников.

**Возвращаемый отчет включает:**
- Топ навыков по популярности
- Статистику по каждому навыку (количество сотрудников, средняя эффективность)
- Топ сотрудников по количеству навыков
- Детальную информацию о навыках каждого сотрудника

**Параметры:**
- `data: List[Dict[str, Any]]` - данные сотрудников

**Возвращает:**
- `str` - отформатированный отчет по навыкам

**Пример вывода:**
```
=== ОТЧЕТ ПО НАВЫКАМ СОТРУДНИКОВ ===

╔════╤═══════════════════╤═══════════════════════╤═══════════════════════════╗
║ №  │ Навык             │ Количество сотрудников│ Средняя эффективность     ║
╠════╪═══════════════════╪═══════════════════════╪═══════════════════════════╣
║ 1  │ Python            │ 8                     │ 4.65                      ║
║ 2  │ JavaScript        │ 6                     │ 4.58                      ║
╚════╧═══════════════════╧═══════════════════════╧═══════════════════════════╝

╔════╤═══════════════════════╤═══════════════════════╤═══════════════════╗
║ №  │ Имя                   │ Позиция               │ Эффективность     ║
╠════╪═══════════════════════╪═══════════════════════╪═══════════════════╣
║ 1  │ Иван Петров           │ Backend Developer     │ 4.5               ║
╚════╧═══════════════════════╧═══════════════════════╧═══════════════════╝
```

### Вспомогательные методы

#### _parse_skills_from_data()

Парсит навыки из строкового поля в список.

**Параметры:**
- `data: List[Dict[str, Any]]` - исходные данные

**Возвращает:**
- `List[Dict[str, Any]]` - данные с распарсенными навыками

#### _parse_skills_string()

Парсит строку навыков в список.

**Параметры:**
- `skills_string: str` - строка с навыками, разделенными запятыми

**Возвращает:**
- `List[str]` - список навыков

**Пример:**
```python
"Python, JavaScript, Docker" -> ["Python", "JavaScript", "Docker"]
```

#### _analyze_skills_distribution()

Анализирует распределение навыков среди сотрудников.

**Параметры:**
- `data: List[Dict[str, Any]]` - данные с распарсенными навыками

**Возвращает:**
- `List[Dict[str, Any]]` - статистика по навыкам

**Фильтрация:**
- Исключает навыки, встречающиеся реже, чем `SKILLS_REPORT_MIN_OCCURRENCE` (по умолчанию 2)

#### _analyze_employees_skills()

Анализирует сотрудников по количеству навыков.

**Параметры:**
- `data: List[Dict[str, Any]]` - данные с распарсенными навыками

**Возвращает:**
- `List[Dict[str, Any]]` - статистика по сотрудникам

#### _format_skills_report()

Форматирует полный отчет по навыкам.

**Параметры:**
- `skills_stats: List[Dict]` - статистика по навыкам
- `employees_stats: List[Dict]` - статистика по сотрудникам

**Возвращает:**
- `str` - полный отформатированный отчет

#### _format_skills_table()

Форматирует таблицу навыков (топ 10).

**Параметры:**
- `skills_stats: List[Dict]` - статистика по навыкам

**Возвращает:**
- `str` - отформатированная таблица навыков

#### _format_employees_table()

Форматирует таблицу сотрудников (топ 10).

**Параметры:**
- `employees_stats: List[Dict]` - статистика по сотрудникам

**Возвращает:**
- `str` - отформатированная таблица сотрудников

---

## ReportGenerator

Фабрика отчетов, управляющая созданием различных типов отчетов.

### Конструктор

### __init__()

Создает генератор отчетов с предустановленными типами:
- `'performance'` - PerformanceReport
- `'skills'` - SkillsReport

### Основные методы

### generate_report()

Генерирует отчет указанного типа.

```python
generator = ReportGenerator()
report = generator.generate_report('performance', data)
```

**Параметры:**
- `report_type: str` - тип отчета ('performance' или 'skills')
- `data: List[Dict[str, Any]]` - данные для анализа

**Возвращает:**
- `str` - отформатированный отчет

**Исключения:**
- `ValueError` - если тип отчета не поддерживается

**Доступные типы отчетов:**
- `'performance'` - отчет по эффективности
- `'skills'` - отчет по навыкам

## Примеры использования

### Базовое использование

```python
from src.report_generator import ReportGenerator

# Создаем генератор
generator = ReportGenerator()

# Генерируем отчет по эффективности
performance_report = generator.generate_report('performance', employee_data)

# Генерируем отчет по навыкам
skills_report = generator.generate_report('skills', employee_data)

print(performance_report)
print(skills_report)
```

### Создание пользовательского отчета

```python
from src.report_generator import BaseReport

class CustomReport(BaseReport):
    def __init__(self):
        super().__init__("custom")
    
    def generate(self, data: List[Dict[str, Any]]) -> str:
        # Ваша логика генерации отчета
        return "Пользовательский отчет"

# Добавляем в генератор
generator = ReportGenerator()
generator.reports['custom'] = CustomReport()
custom_report = generator.generate_report('custom', data)
```

### Работа с пустыми данными

```python
# Обработка пустых данных
empty_data = []
performance_report = generator.generate_report('performance', empty_data)
# Вернет пустую таблицу с заголовками

skills_report = generator.generate_report('skills', empty_data)
# Вернет "Нет данных для анализа навыков"
```

## Конфигурация

Система отчетов использует следующие параметры конфигурации:

- `SORT_BY_PERFORMANCE` - включить сортировку по эффективности
- `SORT_ORDER` - порядок сортировки ('asc' или 'desc')
- `SKILLS_REPORT_MIN_OCCURRENCE` - минимальное количество упоминаний навыка
- `table_format` - формат таблицы для tabulate

## Связанные компоненты

- **Конфигурация:** Использует `src.config.config` для настроек
- **Табличное форматирование:** Использует библиотеку `tabulate`
- **Интеграция:** Может быть адаптирован через `src.adapters.report_generator_adapter`